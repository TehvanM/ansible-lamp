<!DOCTYPE html>
<html>
<head>
    <title>LAMP Stack Test - {{ ansible_hostname }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .success { color: green; }
        .error { color: red; }
        .info { background: #f0f0f0; padding: 20px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>LAMP Stack Test Page</h1>
    
    <div class="info">
        <h2>Server Information</h2>
        <p><strong>Hostname:</strong> {{ ansible_hostname }}</p>
        <p><strong>IP Address:</strong> {{ ansible_default_ipv4.address }}</p>
        <p><strong>Student:</strong> {{ student_username }}</p>
        <p><strong>Domain:</strong> {{ domain_name }}</p>
    </div>

    <h2>PHP Information</h2>
    <?php
    echo "<p><strong>PHP Version:</strong> " . phpversion() . "</p>";
    
    // Test MySQL connection
    $host = "localhost";
    $user = "{{ mysql_user }}";
    $pass = "{{ mysql_password }}";
    $db = "{{ mysql_database }}";
    
    try {
        $conn = new PDO("mysql:host=$host;dbname=$db", $user, $pass);
        $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        echo "<p class='success'>✓ MySQL Connection: SUCCESS</p>";
        
        // Test database operations
        $stmt = $conn->query("SELECT VERSION() as version");
        $mysql_version = $stmt->fetch(PDO::FETCH_ASSOC);
        echo "<p><strong>MySQL Version:</strong> " . $mysql_version['version'] . "</p>";
        
    } catch(PDOException $e) {
        echo "<p class='error'>✗ MySQL Connection: FAILED - " . $e->getMessage() . "</p>";
    }
    ?>
    
    <h2>Loaded PHP Extensions</h2>
    <ul>
        <?php
        $extensions = get_loaded_extensions();
        sort($extensions);
        foreach ($extensions as $ext) {
            echo "<li>$ext</li>";
        }
        ?>
    </ul>
    
    <hr>
    <p><em>Generated by Ansible LAMP Stack</em></p>
</body>
</html>
